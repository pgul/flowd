
prefix=@prefix@
CC=@CC@
AWK=@AWK@
COPT=-Wall -funsigned-char @DEFS@ -DCONFDIR=\"@sysconfdir@\" @CFLAGS@

SRCS=flowd.c acl.c stat.c config.c getclass.c
OBJS=${SRCS:.c=.o}

.c.o:
	@echo Compiling $*.c...
	@$(CC) -c $(COPT) -o $*.o $*.c

all:	flowd

flowd:	$(OBJS)
	@echo Linking $@...
	@$(CC) $(COPT) @LDFLAGS@ -o flowd $(OBJS) @LIBS@

testacl:	acl.c flowd.h
	$(CC) -g -Wall -DMAKETEST=1 -o testacl -O2 -funsigned-char acl.c
test:		test.c
	$(CC) -g -Wall -o test -O2 -funsigned-char test.c -lpcap

install:	all
	install flowd $(prefix)/bin
	install flowd.conf @sysconfdir@

clean:
	rm -f *.o config.log config.cache config.status

flowd.o: flowd.c flowd.h
acl.o: acl.c flowd.h
stat.o: stat.c flowd.h
config.o: config.c flowd.h
getclass.o: getclass.c flowd.h
